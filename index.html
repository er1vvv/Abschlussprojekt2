<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ Reflexions-Radar v5.4.3 OPTIMIZED</title>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --glass-bg: rgba(255,255,255,0.1);
            --glass-border: rgba(255,255,255,0.2);
            --stress-0: #9E9E9E;
            --stress-1: #4CAF50;
            --stress-2: #8BC34A;
            --stress-3: #FFC107;
            --stress-4: #FF9800;
            --stress-5: #F44336;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--primary-gradient); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; min-height: 100vh; user-select: none; }
        .header { position: fixed; top: 0; left: 0; right: 0; height: 70px; background: rgba(0,0,0,0.85); backdrop-filter: blur(20px); display: flex; align-items: center; padding: 0 20px; z-index: 1000; border-bottom: 2px solid var(--glass-border); box-shadow: 0 2px 20px rgba(0,0,0,0.3); }
        .header h1 { color: white; font-size: 20px; margin-right: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); font-weight: 700; }
        .header-buttons { display: flex; gap: 8px; flex: 1; flex-wrap: wrap; }
        .header-stats { display: flex; gap: 15px; margin-left: auto; align-items: center; }
        .btn { background: var(--glass-bg); border: 2px solid var(--glass-border); color: white; padding: 8px 14px; border-radius: 20px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px; min-width: 44px; min-height: 44px; white-space: nowrap; backdrop-filter: blur(10px); }
        .btn:hover { background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.4); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn.active { background: rgba(76,175,80,0.3); border-color: #4CAF50; }
        .stat { color: white; font-size: 12px; background: rgba(0,0,0,0.4); padding: 6px 10px; border-radius: 12px; border: 1px solid var(--glass-border); font-weight: 600; }
        #canvas { position: absolute; top: 70px; left: 0; right: 0; bottom: 0; overflow: hidden; background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.05) 0%, transparent 70%); }
        #connectionsSvg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2; }
        #connectionsSvg line { stroke-width: 4; stroke-linecap: round; opacity: 0.85; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .connection-emoji { position: absolute; font-size: 24px; background: linear-gradient(145deg, rgba(0,0,0,0.95), rgba(0,0,0,0.85)); border-radius: 50%; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 5; transform: translate(-50%, -50%); border: 3px solid rgba(255,255,255,0.6); transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.5); backdrop-filter: blur(15px); pointer-events: auto; }
        .connection-emoji:hover { transform: translate(-50%, -50%) scale(1.3); border-color: rgba(255,255,255,0.9); box-shadow: 0 6px 25px rgba(0,0,0,0.7); }
        .member { position: absolute; width: 100px; height: 100px; border-radius: 50%; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: move; font-size: 12px; text-align: center; box-shadow: 0 6px 20px rgba(0,0,0,0.4); transition: all 0.3s ease; user-select: none; touch-action: none; border: 3px solid rgba(255,255,255,0.3); backdrop-filter: blur(5px); z-index: 10; }
        .member:hover { transform: scale(1.1); box-shadow: 0 8px 25px rgba(0,0,0,0.5); border-color: rgba(255,255,255,0.6); }
        .member.dragging { transform: scale(1.15); z-index: 50; cursor: grabbing; }
        .member.self { border-color: #FFD700; box-shadow: 0 0 20px rgba(255,215,0,0.6), 0 6px 20px rgba(0,0,0,0.4); }
        .member-name { font-weight: 700; margin-bottom: 4px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); font-size: 11px; padding: 0 5px; }
        .stress-indicator { background: rgba(0,0,0,0.7); padding: 2px 6px; border-radius: 10px; font-size: 9px; cursor: pointer; transition: all 0.2s ease; border: 1px solid rgba(255,255,255,0.4); font-weight: 600; }
        .stress-indicator:hover { background: rgba(0,0,0,0.9); transform: scale(1.1); }
        .notes-badge { position: absolute; top: -5px; right: -5px; width: 24px; height: 24px; background: rgba(255,193,7,0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.8); z-index: 15; }
        .notes-badge:hover { transform: scale(1.2); background: rgba(255,193,7,1); }
        .notes-display { position: absolute; top: 110px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.95); backdrop-filter: blur(20px); color: white; padding: 12px 16px; border-radius: 10px; font-size: 13px; max-width: 250px; min-width: 200px; z-index: 100; border: 2px solid rgba(255,193,7,0.6); box-shadow: 0 4px 16px rgba(0,0,0,0.5); line-height: 1.4; white-space: pre-wrap; word-wrap: break-word; pointer-events: none; }
        .stress-0 { background: linear-gradient(135deg, #9E9E9E, #757575) !important; }
        .stress-1 { background: linear-gradient(135deg, #4CAF50, #388E3C) !important; }
        .stress-2 { background: linear-gradient(135deg, #8BC34A, #689F38) !important; }
        .stress-3 { background: linear-gradient(135deg, #FFC107, #FFA000) !important; }
        .stress-4 { background: linear-gradient(135deg, #FF9800, #F57C00) !important; }
        .stress-5 { background: linear-gradient(135deg, #F44336, #D32F2F) !important; }
        .stress-thermometer { position: fixed; top: 90px; right: 20px; width: 100px; background: rgba(0,0,0,0.85); backdrop-filter: blur(20px); border-radius: 15px; padding: 20px; border: 2px solid var(--glass-border); color: white; box-shadow: 0 8px 25px rgba(0,0,0,0.4); z-index: 100; transition: all 0.3s ease; cursor: move; }
        .stress-thermometer.dragging { cursor: grabbing; box-shadow: 0 12px 35px rgba(0,0,0,0.6); }
        .stress-thermometer.collapsed { width: 50px; height: 50px; padding: 10px; overflow: hidden; }
        .thermometer-toggle { position: absolute; top: 5px; right: 5px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 12px; transition: all 0.2s ease; z-index: 10; }
        .thermometer-toggle:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); }
        .thermometer-content { transition: opacity 0.3s ease; }
        .stress-thermometer.collapsed .thermometer-content { opacity: 0; pointer-events: none; }
        .thermometer-header { text-align: center; margin-bottom: 15px; font-weight: 700; font-size: 14px; cursor: move; user-select: none; }
        .stress-display { text-align: center; margin-bottom: 15px; }
        .stress-value { font-size: 32px; font-weight: 700; color: #FFC107; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .stress-bar { height: 120px; width: 20px; background: linear-gradient(to top, var(--stress-1) 0%, var(--stress-1) 20%, var(--stress-2) 20%, var(--stress-2) 40%, var(--stress-3) 40%, var(--stress-3) 60%, var(--stress-4) 60%, var(--stress-4) 80%, var(--stress-5) 80%, var(--stress-5) 100%); border-radius: 10px; border: 2px solid rgba(255,255,255,0.3); margin: 0 auto; position: relative; box-shadow: inset 0 2px 10px rgba(0,0,0,0.3); }
        .stress-indicator-marker { position: absolute; right: -8px; width: 0; height: 0; border-left: 8px solid white; border-top: 6px solid transparent; border-bottom: 6px solid transparent; transition: all 0.3s ease; filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5)); }
        .reflexions-panel { position: fixed; top: 90px; right: 140px; display: none; max-height: 70vh; overflow-y: auto; width: 320px; background: rgba(0,0,0,0.85); backdrop-filter: blur(20px); border-radius: 15px; padding: 20px; border: 2px solid var(--glass-border); color: white; box-shadow: 0 8px 25px rgba(0,0,0,0.4); z-index: 100; }
        .reflexion-item { background: rgba(255,255,255,0.05); border-left: 4px solid #4CAF50; border-radius: 10px; padding: 15px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s ease; }
        .reflexion-item:hover { background: rgba(255,255,255,0.1); transform: translateX(5px); }
        .reflexion-category { font-size: 12px; font-weight: 600; opacity: 0.8; margin-bottom: 5px; }
        .reflexion-question { font-size: 14px; font-weight: 600; margin-bottom: 8px; line-height: 1.4; }
        .reflexion-answer { font-size: 13px; font-style: italic; opacity: 0.9; margin-bottom: 8px; line-height: 1.4; }
        .reflexion-timestamp { font-size: 11px; opacity: 0.6; }
        .timeline-panel { position: fixed; bottom: 20px; left: 20px; right: 20px; height: 140px; background: rgba(0,0,0,0.85); backdrop-filter: blur(20px); border-radius: 15px; padding: 15px; z-index: 100; border: 2px solid var(--glass-border); display: none; box-shadow: 0 8px 25px rgba(0,0,0,0.4); }
        .timeline-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; color: white; font-weight: 700; }
        .timeline-controls { display: flex; gap: 5px; }
        .timeline-points { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.3) transparent; }
        .timeline-points::-webkit-scrollbar { height: 6px; }
        .timeline-points::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 3px; }
        .timeline-point { min-width: 90px; height: 70px; background: var(--glass-bg); border: 2px solid var(--glass-border); border-radius: 8px; padding: 8px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-size: 10px; text-align: center; transition: all 0.2s ease; backdrop-filter: blur(10px); position: relative; }
        .timeline-point:hover { transform: translateY(-2px) scale(1.05); background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.4); }
        .timeline-point.active { background: rgba(76,175,80,0.3); border-color: #4CAF50; transform: scale(1.1); }
        .timeline-point.dragging { opacity: 0.5; transform: scale(0.9); }
        .snapshot-name { font-weight: 600; margin-bottom: 4px; }
        .snapshot-time { opacity: 0.7; font-size: 9px; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); display: none; align-items: center; justify-content: center; z-index: 2000; }
        .modal { background: rgba(0,0,0,0.9); backdrop-filter: blur(25px); border: 2px solid var(--glass-border); border-radius: 20px; padding: 25px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; color: white; box-shadow: 0 20px 60px rgba(0,0,0,0.8); }
        .modal h3 { margin-bottom: 20px; text-align: center; font-size: 22px; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .modal-buttons { display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
        .context-menu { position: fixed; background: rgba(20,20,20,0.95); backdrop-filter: blur(25px); border-radius: 12px; padding: 8px 0; min-width: 200px; border: 2px solid var(--glass-border); z-index: 1500; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .context-item { padding: 12px 16px; color: white; cursor: pointer; transition: all 0.2s ease; font-size: 14px; display: flex; align-items: center; gap: 8px; font-weight: 500; }
        .context-item:hover { background: rgba(255,255,255,0.1); padding-left: 20px; }
        .emoji-selector { position: fixed; background: rgba(15,15,15,0.95); backdrop-filter: blur(25px); border-radius: 20px; padding: 25px; z-index: 1500; display: none; border: 2px solid var(--glass-border); max-width: 450px; max-height: 80vh; overflow-y: auto; box-shadow: 0 15px 50px rgba(0,0,0,0.7); }
        .emoji-selector h3 { color: white; text-align: center; margin-bottom: 20px; font-size: 18px; }
        .emoji-category { margin-bottom: 20px; }
        .emoji-category-title { color: #667eea; font-size: 14px; font-weight: 600; margin-bottom: 10px; padding-left: 5px; }
        .emoji-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-bottom: 15px; }
        .emoji-option { width: 50px; height: 50px; border-radius: 12px; background: var(--glass-bg); border: 2px solid var(--glass-border); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 24px; transition: all 0.2s ease; backdrop-filter: blur(10px); }
        .emoji-option:hover { background: rgba(255,255,255,0.2); transform: scale(1.15); border-color: rgba(255,255,255,0.5); }
        .color-options { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
        .color-option { display: flex; align-items: center; gap: 15px; padding: 12px; background: rgba(255,255,255,0.05); border: 2px solid var(--glass-border); border-radius: 10px; cursor: pointer; transition: all 0.3s ease; }
        .color-option:hover { background: rgba(255,255,255,0.15); transform: translateX(5px); }
        .color-circle { width: 32px; height: 32px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.3); }
        .color-label { color: white; font-weight: 600; flex: 1; }
        .scaling-bar { display: flex; justify-content: space-between; margin: 20px 0; gap: 5px; }
        .scaling-btn { width: 40px; height: 40px; padding: 0; font-size: 14px; border-radius: 8px; min-width: 40px; }
        .scaling-btn.active { background: rgba(76,175,80,0.5); border-color: #4CAF50; transform: scale(1.1); }
        .scaling-labels { display: flex; justify-content: space-between; font-size: 12px; opacity: 0.7; margin-top: 5px; }
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; background: rgba(255,255,255,0.1); border: 2px solid var(--glass-border); border-radius: 10px; color: white; font-size: 14px; font-family: inherit; transition: all 0.3s ease; backdrop-filter: blur(10px); }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #4CAF50; background: rgba(255,255,255,0.15); box-shadow: 0 0 15px rgba(76,175,80,0.3); }
        input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.6); }
        select option { background: #333; color: white; }
        .notification { position: fixed; top: 80px; right: 20px; background: rgba(76,175,80,0.9); color: white; padding: 12px 20px; border-radius: 10px; border: 2px solid rgba(255,255,255,0.3); z-index: 3000; box-shadow: 0 4px 15px rgba(0,0,0,0.3); font-weight: 600; animation: slideIn 0.3s ease; backdrop-filter: blur(10px); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .question-text { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; border-left: 4px solid #667eea; margin-bottom: 15px; line-height: 1.6; }
        .session-item { background: rgba(255,255,255,0.05); padding: 15px; margin: 10px 0; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--glass-border); }
        .session-info { flex: 1; }
        .session-name { font-weight: 600; margin-bottom: 5px; }
        .session-timestamp { font-size: 12px; opacity: 0.7; }
        @media (max-width: 768px) {
            .header { padding: 0 10px; height: auto; min-height: 70px; flex-wrap: wrap; }
            .header h1 { font-size: 16px; width: 100%; margin-bottom: 8px; text-align: center; }
            .btn { padding: 6px 10px; font-size: 11px; margin: 2px; }
            #canvas { top: 100px; }
            .member { width: 90px; height: 90px; font-size: 11px; }
            .stress-thermometer { top: 110px; right: 10px; width: 80px; padding: 15px; }
            .reflexions-panel { right: 10px; left: 10px; width: auto; max-height: 50vh; }
            .timeline-panel { left: 10px; right: 10px; height: 120px; }
            .modal { padding: 20px 15px; width: 95%; }
            .emoji-selector { width: 95%; max-width: 350px; padding: 15px; }
            .emoji-grid { grid-template-columns: repeat(5, 1fr); gap: 8px; }
            .emoji-option { width: 45px; height: 45px; font-size: 20px; }
        }
        .hidden { display: none !important; }
        .mb-10 { margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¯ Reflexions-Radar v5.4.3</h1>
        <div class="header-buttons">
            <button class="btn" id="btnUndo" disabled>â†¶</button>
            <button class="btn" id="btnRedo" disabled>â†·</button>
            <button class="btn" id="btnShowReflexion">ğŸ’­ Reflexion</button>
            <button class="btn" id="btnToggleTimeline">ğŸ“Š Timeline</button>
            <button class="btn" id="btnShowSessions">ğŸ“ Sessions</button>
            <button class="btn" id="btnToggleReflexions">ğŸ“ Historie</button>
            <button class="btn" id="btnReset">ğŸ”„ Reset</button>
        </div>
        <div class="header-stats">
            <div class="stat">ğŸ‘¥ <span id="memberCount">0</span></div>
            <div class="stat">ğŸ”— <span id="connectionCount">0</span></div>
            <div class="stat">ğŸ’­ <span id="reflexionCount">0</span></div>
            <div class="stat">âš¡ <span id="avgStress">0.0</span></div>
        </div>
    </div>
    
    <div id="canvas"><svg id="connectionsSvg"></svg></div>
    
    <div class="stress-thermometer" id="stressThermometer">
        <div class="thermometer-toggle" id="thermometerToggle">â—€</div>
        <div class="thermometer-content">
            <div class="thermometer-header">ğŸŒ¡ï¸ Team-Stress</div>
            <div class="stress-display">
                <div class="stress-value" id="avgStressDisplay">0.0</div>
                <div style="font-size: 10px; opacity: 0.7;">von 5.0</div>
            </div>
            <div class="stress-bar"><div class="stress-indicator-marker" id="stressMarker"></div></div>
            <div style="font-size: 10px; margin-top: 10px; text-align: center; opacity: 0.7;">Klicke Stress<br>zum Ã„ndern</div>
        </div>
    </div>
    
    <div class="reflexions-panel" id="reflexionsPanel">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h4>ğŸ’­ Reflexions-Historie</h4>
            <button class="btn" style="padding: 4px 8px; font-size: 12px;" id="btnCloseReflexions">âœ•</button>
        </div>
        <div id="reflexionsList"><p style="text-align: center; opacity: 0.7;">Noch keine Reflexionen</p></div>
    </div>
    
    <div class="timeline-panel" id="timelinePanel">
        <div class="timeline-header">
            <span>ğŸ“Š Timeline & Entwicklung</span>
            <div class="timeline-controls">
                <button class="btn" id="btnCaptureSnapshot" style="padding: 6px 10px; font-size: 12px;">ğŸ“· Snapshot</button>
                <button class="btn" id="btnPlayTimeline" style="padding: 6px 10px; font-size: 12px;">â–¶ï¸</button>
                <button class="btn" id="btnPrevSnapshot" style="padding: 6px 10px; font-size: 12px;">â®ï¸</button>
                <button class="btn" id="btnNextSnapshot" style="padding: 6px 10px; font-size: 12px;">â­ï¸</button>
                <button class="btn" id="btnCloseTimeline" style="padding: 6px 10px; font-size: 12px;">âœ•</button>
            </div>
        </div>
        <div id="timelinePoints" class="timeline-points"></div>
    </div>
    
    <div class="context-menu" id="canvasContextMenu">
        <div class="context-item" data-action="addMember">â• Person hinzufÃ¼gen</div>
        <div class="context-item" data-action="addConnection">ğŸ”— Verbindung erstellen</div>
        <div class="context-item" data-action="showReflexion">ğŸ’­ Reflexion</div>
    </div>
    
    <div class="context-menu" id="memberContextMenu">
        <div class="context-item" data-action="renameMember">âœï¸ Umbenennen</div>
        <div class="context-item" data-action="markAsSelf">â­ Als mich markieren</div>
        <div class="context-item" data-action="editNotes">ğŸ“ Notizen bearbeiten</div>
        <div class="context-item" data-action="addConnection">ğŸ”— Verbindung erstellen</div>
        <div class="context-item" data-action="deleteMember">ğŸ—‘ï¸ LÃ¶schen</div>
    </div>
    
    <div class="context-menu" id="connectionContextMenu">
        <div class="context-item" data-action="changeEmoji">ğŸ˜€ Emoji Ã¤ndern</div>
        <div class="context-item" data-action="changeColor">ğŸ¨ Farbe Ã¤ndern</div>
        <div class="context-item" data-action="deleteConnection">ğŸ—‘ï¸ LÃ¶schen</div>
    </div>
    
    <div class="context-menu" id="snapshotContextMenu">
        <div class="context-item" data-action="renameSnapshot">âœï¸ Umbenennen</div>
        <div class="context-item" data-action="deleteSnapshot">ğŸ—‘ï¸ LÃ¶schen</div>
    </div>
    
    <div class="context-menu" id="reflexionContextMenu">
        <div class="context-item" data-action="editReflexion">âœï¸ Bearbeiten</div>
        <div class="context-item" data-action="deleteReflexion">ğŸ—‘ï¸ LÃ¶schen</div>
    </div>
    
    <div class="emoji-selector" id="emojiSelector">
        <h3>ğŸ˜€ Emoji wÃ¤hlen</h3>
        <div class="emoji-category">
            <div class="emoji-category-title">ğŸ¤ Zusammenarbeit & Kooperation</div>
            <div class="emoji-grid">
                <div class="emoji-option" data-emoji="ğŸ¤">ğŸ¤</div>
                <div class="emoji-option" data-emoji="ğŸ‘">ğŸ‘</div>
                <div class="emoji-option" data-emoji="ğŸ™Œ">ğŸ™Œ</div>
                <div class="emoji-option" data-emoji="ğŸ‘">ğŸ‘</div>
                <div class="emoji-option" data-emoji="ğŸ¤œ">ğŸ¤œ</div>
                <div class="emoji-option" data-emoji="ğŸ¤›">ğŸ¤›</div>
            </div>
        </div>
        <div class="emoji-category">
            <div class="emoji-category-title">ğŸ’¬ Kommunikation & Dialog</div>
            <div class="emoji-grid">
                <div class="emoji-option" data-emoji="ğŸ’¬">ğŸ’¬</div>
                <div class="emoji-option" data-emoji="ğŸ“">ğŸ“</div>
                <div class="emoji-option" data-emoji="ğŸ—£ï¸">ğŸ—£ï¸</div>
                <div class="emoji-option" data-emoji="ğŸ’­">ğŸ’­</div>
                <div class="emoji-option" data-emoji="ğŸ“¢">ğŸ“¢</div>
                <div class="emoji-option" data-emoji="ğŸ””">ğŸ””</div>
            </div>
        </div>
        <div class="emoji-category">
            <div class="emoji-category-title">â¤ï¸ Beziehung & Vertrauen</div>
            <div class="emoji-grid">
                <div class="emoji-option" data-emoji="â¤ï¸">â¤ï¸</div>
                <div class="emoji-option" data-emoji="ğŸ’™">ğŸ’™</div>
                <div class="emoji-option" data-emoji="ğŸ’š">ğŸ’š</div>
                <div class="emoji-option" data-emoji="ğŸ’œ">ğŸ’œ</div>
                <div class="emoji-option" data-emoji="ğŸ§¡">ğŸ§¡</div>
                <div class="emoji-option" data-emoji="ğŸ’›">ğŸ’›</div>
            </div>
        </div>
        <div class="emoji-category">
            <div class="emoji-category-title">âš¡ Energie & Dynamik</div>
            <div class="emoji-grid">
                <div class="emoji-option" data-emoji="âš¡">âš¡</div>
                <div class="emoji-option" data-emoji="ğŸ”¥">ğŸ”¥</div>
                <div class="emoji-option" data-emoji="âœ¨">âœ¨</div>
                <div class="emoji-option" data-emoji="ğŸŒŸ">ğŸŒŸ</div>
                <div class="emoji-option" data-emoji="ğŸ’«">ğŸ’«</div>
                <div class="emoji-option" data-emoji="ğŸš€">ğŸš€</div>
            </div>
        </div>
        <div class="emoji-category">
            <div class="emoji-category-title">ğŸ›¡ï¸ UnterstÃ¼tzung & Schutz</div>
            <div class="emoji-grid">
                <div class="emoji-option" data-emoji="ğŸ›¡ï¸">ğŸ›¡ï¸</div>
                <div class="emoji-option" data-emoji="ğŸ¤—">ğŸ¤—</div>
                <div class="emoji-option" data-emoji="ğŸ’ª">ğŸ’ª</div>
                <div class="emoji-option" data-emoji="ğŸ™">ğŸ™</div>
                <div class="emoji-option" data-emoji="ğŸ«‚">ğŸ«‚</div>
                <div class="emoji-option" data-emoji="ğŸ¯">ğŸ¯</div>
            </div>
        </div>
        <div class="emoji-category">
            <div class="emoji-category-title">âš ï¸ Spannung & Konflikt</div>
            <div class="emoji-grid">
                <div class="emoji-option" data-emoji="ğŸ’”">ğŸ’”</div>
                <div class="emoji-option" data-emoji="âš ï¸">âš ï¸</div>
                <div class="emoji-option" data-emoji="ğŸ’¥">ğŸ’¥</div>
                <div class="emoji-option" data-emoji="ğŸ˜¡">ğŸ˜¡</div>
                <div class="emoji-option" data-emoji="âŒ">âŒ</div>
                <div class="emoji-option" data-emoji="ğŸš«">ğŸš«</div>
            </div>
        </div>
        <div class="emoji-category">
            <div class="emoji-category-title">ğŸ¨ KreativitÃ¤t & Innovation</div>
            <div class="emoji-grid">
                <div class="emoji-option" data-emoji="ğŸ¨">ğŸ¨</div>
                <div class="emoji-option" data-emoji="ğŸ’¡">ğŸ’¡</div>
                <div class="emoji-option" data-emoji="ğŸ”">ğŸ”</div>
                <div class="emoji-option" data-emoji="ğŸ§©">ğŸ§©</div>
                <div class="emoji-option" data-emoji="âš™ï¸">âš™ï¸</div>
                <div class="emoji-option" data-emoji="ğŸ”§">ğŸ”§</div>
            </div>
        </div>
        <div class="emoji-category">
            <div class="emoji-category-title">â“ Neutral & Unbestimmt</div>
            <div class="emoji-grid">
                <div class="emoji-option" data-emoji="â“">â“</div>
                <div class="emoji-option" data-emoji="ğŸ¤”">ğŸ¤”</div>
                <div class="emoji-option" data-emoji="ğŸ¤·">ğŸ¤·</div>
                <div class="emoji-option" data-emoji="ğŸ˜">ğŸ˜</div>
                <div class="emoji-option" data-emoji="â¡ï¸">â¡ï¸</div>
                <div class="emoji-option" data-emoji="â†”ï¸">â†”ï¸</div>
            </div>
        </div>
        <div class="modal-buttons"><button class="btn" id="btnCloseEmojiSelector">âœ• SchlieÃŸen</button></div>
    </div>
    
    <div class="emoji-selector" id="colorSelector" style="max-width: 400px;">
        <h3>ğŸ¨ Farbe wÃ¤hlen</h3>
        <div class="color-options">
            <div class="color-option" data-color="#4CAF50"><div class="color-circle" style="background: #4CAF50;"></div><div class="color-label">ğŸŸ¢ GrÃ¼n - Harmonie & UnterstÃ¼tzung</div></div>
            <div class="color-option" data-color="#2196F3"><div class="color-circle" style="background: #2196F3;"></div><div class="color-label">ğŸ”µ Blau - Neutral & Kollegial</div></div>
            <div class="color-option" data-color="#FF9800"><div class="color-circle" style="background: #FF9800;"></div><div class="color-label">ğŸŸ  Orange - Energie & Dynamik</div></div>
            <div class="color-option" data-color="#F44336"><div class="color-circle" style="background: #F44336;"></div><div class="color-label">ğŸ”´ Rot - Konflikt & Spannung</div></div>
            <div class="color-option" data-color="#9C27B0"><div class="color-circle" style="background: #9C27B0;"></div><div class="color-label">ğŸŸ£ Lila - Kreativ & Innovation</div></div>
            <div class="color-option" data-color="#9E9E9E"><div class="color-circle" style="background: #9E9E9E;"></div><div class="color-label">âš« Grau - Distanz & Unbeteiligt</div></div>
        </div>
        <div class="modal-buttons"><button class="btn" id="btnCloseColorSelector">âœ• SchlieÃŸen</button></div>
    </div>
    
    <div class="modal-overlay" id="reflexionModal">
        <div class="modal">
            <h3 id="reflexionTitle">ğŸ’­ Systemische Reflexion</h3>
            <div id="reflexionCategory" class="mb-10" style="text-align: center; font-size: 14px; opacity: 0.8;"></div>
            <div id="reflexionQuestion" class="question-text"></div>
            <div id="reflexionInput"></div>
            <div class="modal-buttons">
                <button class="btn" id="btnSaveReflexion">ğŸ’¾ Speichern</button>
                <button class="btn" id="btnNextReflexion">â¡ï¸ NÃ¤chste</button>
                <button class="btn" id="btnCloseReflexionModal">âœ• SchlieÃŸen</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="sessionModal">
        <div class="modal">
            <h3>ğŸ“ Session-Verwaltung</h3>
            <div class="mb-10">
                <input type="text" id="sessionName" placeholder="Session-Name...">
                <button class="btn" id="btnSaveSession" style="width: 100%; margin-top: 5px;">ğŸ’¾ Session speichern</button>
            </div>
            <div class="mb-10">
                <input type="file" id="sessionFile" accept=".json" style="margin-bottom: 10px;">
                <button class="btn" id="btnImportSession" style="width: 100%;">ğŸ“¥ Importieren</button>
            </div>
            <div id="sessionsList" style="max-height: 200px; overflow-y: auto; margin-bottom: 20px;"></div>
            <h3 style="margin-top: 30px; margin-bottom: 15px; font-size: 18px;">ğŸ“‹ Export & Arbeitsblatt</h3>
            <div class="mb-10">
                <button class="btn" id="btnExportWorksheet" style="width: 100%; margin-bottom: 10px;">ğŸ“„ HTML-Arbeitsblatt</button>
                <button class="btn" id="btnExportJSON" style="width: 100%; margin-bottom: 10px;">ğŸ’¾ Session-Daten (JSON)</button>
            </div>
            <div class="modal-buttons">
                <button class="btn" id="btnClearSessions">ğŸ—‘ï¸ Alle Sessions lÃ¶schen</button>
                <button class="btn" id="btnCloseSession">âœ• SchlieÃŸen</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="connectionModal">
        <div class="modal">
            <h3>ğŸ”— Verbindung erstellen</h3>
            <p id="connectionPromptText">WÃ¤hle zwei Personen fÃ¼r die Verbindung:</p>
            <select id="connectionFrom"><option value="">-- Von Person --</option></select>
            <select id="connectionTo"><option value="">-- Zu Person --</option></select>
            <div class="modal-buttons">
                <button class="btn" id="btnCreateConnection">ğŸ”— Erstellen</button>
                <button class="btn" id="btnCancelConnection">âœ• Abbrechen</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="simpleInputModal">
        <div class="modal">
            <h3 id="simpleInputTitle">Eingabe</h3>
            <input type="text" id="simpleInputField" placeholder="">
            <textarea id="simpleTextareaField" rows="4" placeholder="" style="display:none;"></textarea>
            <div class="modal-buttons">
                <button class="btn" id="btnSimpleInputOK">âœ“ OK</button>
                <button class="btn" id="btnSimpleInputCancel">âœ• Abbrechen</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
const APP_VERSION="5.4.3-OPTIMIZED";let members=[],connections=[],snapshots=[],reflexionAnswers=[],sessions=[],history=[],historyIndex=-1,nextId=1,nextConnectionId=1,personCounter=1,currentSnapshotIndex=0,selectedMember=null,selectedConnection=null,selectedSnapshot=null,selectedSnapshotIndex=-1,selectedReflexion=null,selectedReflexionIndex=-1,draggedMember=null,draggedThermometer=!1,draggedSnapshot=null,draggedSnapshotIndex=-1,dragOffset={x:0,y:0},canvasClickPos={x:0,y:0},isPlaying=!1,playInterval=null,currentReflexionCategory=null,currentReflexionIndex=0,currentQuestionType=null,currentScalingValue=5,thermometerPos={top:90,right:20};const REFLEXIONS_SYSTEM={selbstreflexion:{name:"ğŸª Selbstreflexion",color:"#E91E63",questions:["Welche Rolle nehme ich im Team ein?","Was hindert mich daran, meine Position zu verÃ¤ndern?","Wo spÃ¼re ich Widerstand in mir?","In welchen Situationen fÃ¼hle ich mich am authentischsten?","Was ist mein grÃ¶ÃŸter Beitrag zum Team?","Welche meiner StÃ¤rken sind hier noch unsichtbar?","Was wÃ¼rde ich gerne mehr zeigen?"],assignments:["Achte in den nÃ¤chsten 7 Tagen darauf, wann du diese Rolle verlÃ¤sst.","Beobachte deine kÃ¶rperlichen Reaktionen in Teamsituationen.","Notiere dir tÃ¤glich einen Moment der AuthentizitÃ¤t.","Dokumentiere Situationen, in denen du dich zurÃ¼ckhÃ¤ltst."]},beziehungsdynamik:{name:"ğŸ”— Beziehungsdynamik",color:"#2196F3",questions:["Zu wem habe ich die schwÃ¤chste Verbindung?","Welche Beziehung kostet mich Energie?","Wo entstehen wiederkehrende Muster?","Wer ist mein wichtigster VerbÃ¼ndeter?","Mit wem kommuniziere ich am klarsten?","Wo entstehen MissverstÃ¤ndnisse?","Welche Beziehung hat sich am meisten verÃ¤ndert?"],assignments:["Dokumentiere Momente, in denen sich diese Dynamik zeigt.","FÃ¼hre bewusst ein GesprÃ¤ch mit der schwÃ¤chsten Verbindung.","Beobachte nonverbale Signale in Interaktionen.","Notiere dir Situationen erfolgreicher Zusammenarbeit."]},entwicklung:{name:"ğŸ“ˆ Entwicklung & VerÃ¤nderung",color:"#4CAF50",questions:["Was hat sich in den letzten Monaten verÃ¤ndert?","Welche Entwicklung Ã¼berrascht mich?","Wo sehe ich Potentiale fÃ¼r Wachstum?","Was mÃ¶chte ich lernen?","Welcher Schritt wÃ¤re der nÃ¤chste?","Was hindert uns an VerÃ¤nderung?","Wo waren wir schon einmal anders?"],assignments:["Dokumentiere eine kleine tÃ¤gliche VerÃ¤nderung eine Woche lang.","FÃ¼hre ein EntwicklungsgesprÃ¤ch mit einem Teammitglied.","Beobachte Wachstumsmomente im Team.","Experimentiere mit einem neuen Verhalten."]},systemisch:{name:"ğŸ”„ Systemische Perspektiven",color:"#FF9800",questions:["Was wÃ¼rde X Ã¼ber Y sagen?","Welches Problem lÃ¶st meine Position?","Was wÃ¼rde fehlen, wenn ich nicht da wÃ¤re?","Wer profitiert von der aktuellen Konstellation?","Was ist das Symptom, was ist die Ursache?","Wo sind die LoyalitÃ¤tskonflikte?","Was ist der Auftrag des Systems?"],assignments:["FÃ¼hre ein zirkulÃ¤res Interview mit einem Unbeteiligten.","Beobachte, wer auf VerÃ¤nderungen wie reagiert.","Frage drei verschiedene Perspektiven zu derselben Situation ab.","Achte auf verborgene Regeln und LoyalitÃ¤ten."]},vision:{name:"âœ¨ Visionen & WÃ¼nsche",color:"#9C27B0",questions:["Wie sÃ¤he unser ideales Team aus?","Was ist mein grÃ¶ÃŸter Wunsch fÃ¼r uns?","Woran wÃ¼rden wir merken, dass es besser ist?","Was wÃ¤re das Kleinste, was sich Ã¤ndern mÃ¼sste?","Wenn ein Wunder geschÃ¤he - was wÃ¤re anders?","Welche AtmosphÃ¤re wÃ¼nsche ich mir?","Was sollen andere Ã¼ber uns sagen?"],assignments:["Visualisiere tÃ¤glich 5 Minuten das ideale Team.","Teile deine Vision mit einem Teammitglied.","Achte auf kleine Wunder im Alltag.","Setze einen winzig kleinen Schritt zu deiner Vision um."]}},SCALING_QUESTIONS=["Auf einer Skala von 1-10: Wie zufrieden bist du mit deiner Position im Team?","Wie stark fÃ¼hlst du dich vom Team unterstÃ¼tzt? (1-10)","Wie klar sind dir deine Aufgaben im Team? (1-10)","Wie gut kannst du deine StÃ¤rken einbringen? (1-10)","Wie wohl fÃ¼hlst du dich in der Teamdynamik? (1-10)","Wie effektiv ist unsere Kommunikation? (1-10)","Wie motiviert bist du in diesem Team? (1-10)","Wie gut funktioniert unsere Zusammenarbeit? (1-10)","Wie authentisch kann ich mich im Team zeigen? (1-10)","Wie sehr vertraue ich meinen Teammitgliedern? (1-10)"],MIRACLE_QUESTIONS=["Angenommen, Ã¼ber Nacht geschÃ¤he ein Wunder und unser Team wÃ¤re perfekt - woran wÃ¼rden wir das morgen frÃ¼h merken?","Wenn alle Hindernisse verschwÃ¤nden - wie wÃ¼rden wir dann zusammenarbeiten?","Stellen Sie sich vor, unser Team wird in einem Jahr als Vorbild genannt - was ist dann anders?","Wenn Sie einen Zauberstab hÃ¤tten - was wÃ¼rden Sie am Team verÃ¤ndern?","Angenommen, wir hÃ¤tten unbegrenzte Ressourcen - wie wÃ¼rde unser Team dann aussehen?","Wenn das Team ein Mobile wÃ¤re und alle Teile in Balance - wie sÃ¤he das aus?","Was wÃ¤re das Kleinste, was sich Ã¤ndern mÃ¼sste, damit alles perfekt lÃ¤uft?","Wenn jeder im Team seine Superkraft einsetzen kÃ¶nnte - was wÃ¼rde passieren?","Wenn Kommunikation nie mehr schief gehen wÃ¼rde - wie wÃ¼rde das aussehen?","Wenn alle Konflikte zu LernmÃ¶glichkeiten wÃ¼rden - was wÃ¤re anders?"];function init(){loadFromLocalStorage(),0===snapshots.length&&snapshots.push({id:Date.now(),name:"Ausgangssituation",timestamp:new Date().toLocaleString("de-DE"),members:[],connections:[]}),setupEventListeners(),render()}function setupEventListeners(){document.getElementById("btnUndo").onclick=undo,document.getElementById("btnRedo").onclick=redo,document.getElementById("btnShowReflexion").onclick=showReflexionModal,document.getElementById("btnToggleTimeline").onclick=toggleTimeline,document.getElementById("btnShowSessions").onclick=showSessionModal,document.getElementById("btnToggleReflexions").onclick=toggleReflexionsPanel,document.getElementById("btnReset").onclick=resetApp,document.getElementById("thermometerToggle").onclick=function(e){e.stopPropagation(),toggleThermometer()};const e=document.getElementById("stressThermometer");e.onmousedown=function(t){if(!t.target.closest(".thermometer-toggle")){draggedThermometer=!0,e.classList.add("dragging");const n=e.getBoundingClientRect();dragOffset.x=t.clientX-n.left,dragOffset.y=t.clientY-n.top}};const t=document.getElementById("canvas");t.oncontextmenu=function(e){e.preventDefault();const n=t.getBoundingClientRect();canvasClickPos={x:e.clientX-n.left,y:e.clientY-n.top},showContextMenu("canvasContextMenu",e.clientX,e.clientY)},document.querySelectorAll("#canvasContextMenu .context-item").forEach((function(e){e.onclick=function(){const e=this.getAttribute("data-action");hideAllContextMenus(),"addMember"===e?addMember():"addConnection"===e?startConnectionCreation(null):"showReflexion"===e&&showReflexionModal()}})),document.querySelectorAll("#memberContextMenu .context-item").forEach((function(e){e.onclick=function(){const e=this.getAttribute("data-action");if(hideAllContextMenus(),!selectedMember)return;"renameMember"===e?renameMember(selectedMember):"markAsSelf"===e?markAsSelf(selectedMember):"editNotes"===e?editNotes(selectedMember):"addConnection"===e?startConnectionCreation(selectedMember):"deleteMember"===e&&deleteMember(selectedMember)}})),document.querySelectorAll("#connectionContextMenu .context-item").forEach((function(e){e.onclick=function(){const e=this.getAttribute("data-action");if(hideAllContextMenus(),!selectedConnection)return;"changeEmoji"===e?showEmojiSelector(selectedConnection):"changeColor"===e?showColorSelector(selectedConnection):"deleteConnection"===e&&deleteConnection(selectedConnection)}})),document.querySelectorAll("#snapshotContextMenu .context-item").forEach((function(e){e.onclick=function(){const e=this.getAttribute("data-action");if(hideAllContextMenus(),-1===selectedSnapshotIndex)return;"renameSnapshot"===e?renameSnapshot(selectedSnapshotIndex):"deleteSnapshot"===e&&0!==selectedSnapshotIndex&&deleteSnapshot(selectedSnapshotIndex)}})),document.querySelectorAll("#reflexionContextMenu .context-item").forEach((function(e){e.onclick=function(){const e=this.getAttribute("data-action");if(hideAllContextMenus(),-1===selectedReflexionIndex)return;"editReflexion"===e?editReflexion(selectedReflexionIndex):"deleteReflexion"===e&&deleteReflexion(selectedReflexionIndex)}})),document.querySelectorAll("#emojiSelector .emoji-option").forEach((function(e){e.onclick=function(){const e=this.getAttribute("data-emoji");selectedConnection&&(selectedConnection.emoji=e,render(),saveState(),saveToLocalStorage()),hideEmojiSelector(),showNotification("ğŸ˜€ Emoji geÃ¤ndert")}})),document.getElementById("btnCloseEmojiSelector").onclick=hideEmojiSelector,document.querySelectorAll("#colorSelector .color-option").forEach((function(e){e.onclick=function(){const e=this.getAttribute("data-color");selectedConnection&&(selectedConnection.color=e,render(),saveState(),saveToLocalStorage()),hideColorSelector(),showNotification("ğŸ¨ Farbe geÃ¤ndert")}})),document.getElementById("btnCloseColorSelector").onclick=hideColorSelector,document.getElementById("btnSaveReflexion").onclick=saveReflexion,document.getElementById("btnNextReflexion").onclick=nextReflexion,document.getElementById("btnCloseReflexionModal").onclick=function(){document.getElementById("reflexionModal").style.display="none"},document.getElementById("btnSaveSession").onclick=saveSession,document.getElementById("btnImportSession").onclick=importSession,document.getElementById("btnClearSessions").onclick=clearSessions,document.getElementById("btnCloseSession").onclick=function(){document.getElementById("sessionModal").style.display="none"},document.getElementById("btnExportWorksheet").onclick=exportWorksheet,document.getElementById("btnExportJSON").onclick=exportJSON,document.getElementById("btnCreateConnection").onclick=createConnection,document.getElementById("btnCancelConnection").onclick=function(){document.getElementById("connectionModal").style.display="none"},document.getElementById("btnSimpleInputOK").onclick=function(){if(window.simpleInputCallback){const e="none"!==document.getElementById("simpleTextareaField").style.display?document.getElementById("simpleTextareaField").value:document.getElementById("simpleInputField").value;window.simpleInputCallback(e)}document.getElementById("simpleInputModal").style.display="none"},document.getElementById("btnSimpleInputCancel").onclick=function(){document.getElementById("simpleInputModal").style.display="none"},document.getElementById("btnCloseReflexions").onclick=function(){document.getElementById("reflexionsPanel").style.display="none"},document.getElementById("btnCaptureSnapshot").onclick=captureSnapshot,document.getElementById("btnPlayTimeline").onclick=togglePlay,document.getElementById("btnPrevSnapshot").onclick=prevSnapshot,document.getElementById("btnNextSnapshot").onclick=nextSnapshot,document.getElementById("btnCloseTimeline").onclick=function(){document.getElementById("timelinePanel").style.display="none"},document.addEventListener("click",(function(e){e.target.closest(".context-menu")||hideAllContextMenus()})),document.addEventListener("mousemove",onMouseMove),document.addEventListener("mouseup",onMouseUp)}function render(){const e=document.getElementById("canvas"),t=document.getElementById("connectionsSvg");Array.from(e.children).forEach((function(e){"connectionsSvg"!==e.id&&e.remove()})),t.innerHTML="",connections.forEach((function(n){const s=members.find((function(e){return e.id===n.from})),o=members.find((function(e){return e.id===n.to}));if(s&&o){const i=document.createElementNS("http://www.w3.org/2000/svg","line");i.setAttribute("x1",s.x+50),i.setAttribute("y1",s.y+50),i.setAttribute("x2",o.x+50),i.setAttribute("y2",o.y+50),i.setAttribute("stroke",n.color),t.appendChild(i);const c=(s.x+o.x)/2+50,r=(s.y+o.y)/2+50,a=document.createElement("div");a.className="connection-emoji",a.style.left=c+"px",a.style.top=r+"px",a.textContent=n.emoji,a.onclick=function(e){e.stopPropagation(),selectedConnection=n,showEmojiSelector(n)},a.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation(),selectedConnection=n,showContextMenu("connectionContextMenu",e.clientX,e.clientY)},e.appendChild(a)}})),members.forEach((function(t){const n=document.createElement("div");n.className="member stress-"+t.stress,t.isSelf&&n.classList.add("self"),n.style.left=t.x+"px",n.style.top=t.y+"px";const s=document.createElement("div");s.className="member-name",s.textContent=t.name+(t.isSelf?" â­":"");const o=document.createElement("div");if(o.className="stress-indicator",o.textContent=getStressEmoji(t.stress)+" "+t.stress+"/5",o.onclick=function(e){e.stopPropagation(),cycleStressLevel(t)},n.appendChild(s),n.appendChild(o),t.notes&&t.notes.trim()){const e=document.createElement("div");if(e.className="notes-badge",e.textContent="ğŸ“",e.onclick=function(e){e.stopPropagation(),toggleNotesDisplay(t)},n.appendChild(e),t.notesVisible){const e=document.createElement("div");e.className="notes-display",e.textContent=t.notes,n.appendChild(e)}}n.onmousedown=function(e){0===e.button&&!e.target.classList.contains("stress-indicator")&&!e.target.classList.contains("notes-badge")&&startDrag(e,t,n)},n.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation(),selectedMember=t,showContextMenu("memberContextMenu",e.clientX,e.clientY)},e.appendChild(n)})),updateStats(),updateThermometer(),updateUndoRedoButtons()}function updateStats(){document.getElementById("memberCount").textContent=members.length,document.getElementById("connectionCount").textContent=connections.length,document.getElementById("reflexionCount").textContent=reflexionAnswers.length;const e=members.filter((function(e){return e.stress>0}));if(e.length>0){const t=e.reduce((function(e,t){return e+t.stress}),0)/e.length;document.getElementById("avgStress").textContent=t.toFixed(1)}else document.getElementById("avgStress").textContent="0.0"}function updateThermometer(){const e=members.filter((function(e){return e.stress>0}));if(0===e.length)return document.getElementById("avgStressDisplay").textContent="0.0",void(document.getElementById("stressMarker").style.bottom="0%");const t=e.reduce((function(e,t){return e+t.stress}),0)/e.length;document.getElementById("avgStressDisplay").textContent=t.toFixed(1);const n=t/5*100;document.getElementById("stressMarker").style.bottom=n+"%"}function getStressEmoji(e){return["âšª","ğŸ˜Œ","ğŸ™‚","ğŸ˜","ğŸ˜Ÿ","ğŸ˜°"][e]||"âšª"}function saveState(){history=history.slice(0,historyIndex+1),history.push({members:JSON.parse(JSON.stringify(members)),connections:JSON.parse(JSON.stringify(connections))}),history.length>50?history.shift():historyIndex++,updateUndoRedoButtons()}function undo(){if(historyIndex>0){historyIndex--;const e=history[historyIndex];members=JSON.parse(JSON.stringify(e.members)),connections=JSON.parse(JSON.stringify(e.connections)),render(),saveToLocalStorage()}}function redo(){if(historyIndex<history.length-1){historyIndex++;const e=history[historyIndex];members=JSON.parse(JSON.stringify(e.members)),connections=JSON.parse(JSON.stringify(e.connections)),render(),saveToLocalStorage()}}function updateUndoRedoButtons(){document.getElementById("btnUndo").disabled=historyIndex<=0,document.getElementById("btnRedo").disabled=historyIndex>=history.length-1}function startDrag(e,t,n){draggedMember=t,n.classList.add("dragging");const s=n.getBoundingClientRect();dragOffset.x=e.clientX-s.left,dragOffset.y=e.clientY-s.top}function onMouseMove(e){if(draggedThermometer){const t=document.getElementById("stressThermometer");return t.style.right="auto",t.style.top=e.clientY-dragOffset.y+"px",void(t.style.left=e.clientX-dragOffset.x+"px")}if(draggedMember){const t=document.getElementById("canvas"),n=t.getBoundingClientRect();let s=e.clientX-n.left-dragOffset.x,o=e.clientY-n.top-dragOffset.y;s=Math.max(0,Math.min(s,n.width-100)),o=Math.max(0,Math.min(o,n.height-100)),draggedMember.x=s,draggedMember.y=o,render()}}function onMouseUp(){if(draggedThermometer){document.getElementById("stressThermometer").classList.remove("dragging"),draggedThermometer=!1,saveToLocalStorage()}draggedMember&&(draggedMember=null,saveState(),saveToLocalStorage())}function addMember(){showSimpleInput("Person hinzufÃ¼gen","Name (optional):",!1,(function(e){e&&e.trim()||(e="Person "+personCounter,personCounter++),members.push({id:nextId++,name:e,x:canvasClickPos.x||300,y:canvasClickPos.y||200,stress:3,notes:"",notesVisible:!1,isSelf:!1}),render(),saveState(),saveToLocalStorage(),showNotification("âœ… Person hinzugefÃ¼gt: "+e)}))}function renameMember(e){showSimpleInput("Umbenennen","Neuer Name:",!1,(function(t){t&&(e.name=t,render(),saveState(),saveToLocalStorage(),showNotification("âœï¸ Umbenannt"))}))}function markAsSelf(e){members.forEach((function(e){e.isSelf=!1})),e.isSelf=!0,render(),saveState(),saveToLocalStorage(),showNotification("â­ Als \"Ich\" markiert: "+e.name)}function cycleStressLevel(e){e.stress=(e.stress+1)%6,render(),saveState(),saveToLocalStorage(),showNotification("âš¡ Stress: "+getStressEmoji(e.stress)+" "+e.stress)}function editNotes(e){document.getElementById("simpleTextareaField").value=e.notes||"",showSimpleInput("Notizen bearbeiten","Notizen fÃ¼r "+e.name+":",!0,(function(t){e.notes=t,e.notesVisible=!(!t||!t.trim()),render(),saveState(),saveToLocalStorage(),showNotification("ğŸ“ Notizen gespeichert")}))}function toggleNotesDisplay(e){e.notesVisible=!e.notesVisible,render(),saveToLocalStorage()}function deleteMember(e){confirm('Person "'+e.name+'" lÃ¶schen?')&&(connections=connections.filter((function(t){return t.from!==e.id&&t.to!==e.id})),members=members.filter((function(t){return t.id!==e.id})),render(),saveState(),saveToLocalStorage(),showNotification("ğŸ—‘ï¸ Person gelÃ¶scht"))}function startConnectionCreation(e){const t=document.getElementById("connectionModal"),n=document.getElementById("connectionFrom"),s=document.getElementById("connectionTo");n.innerHTML='<option value="">-- Von Person --</option>',s.innerHTML='<option value="">-- Zu Person --</option>',members.forEach((function(e){const t=document.createElement("option");t.value=e.id,t.textContent=e.name,n.appendChild(t);const o=document.createElement("option");o.value=e.id,o.textContent=e.name,s.appendChild(o)})),e?(n.value=e.id,document.getElementById("connectionPromptText").textContent="Verbindung von "+e.name+" zu:"):document.getElementById("connectionPromptText").textContent="WÃ¤hle zwei Personen fÃ¼r die Verbindung:",t.style.display="flex"}function createConnection(){const e=parseInt(document.getElementById("connectionFrom").value),t=parseInt(document.getElementById("connectionTo").value);if(!e||!t)return void showNotification("âš ï¸ Bitte beide Personen auswÃ¤hlen");if(e===t)return void showNotification("âš ï¸ Gleiche Person kann nicht verbunden werden");connections.some((function(n){return n.from===e&&n.to===t||n.from===t&&n.to===e}))?showNotification("âš ï¸ Verbindung existiert bereits"):(connections.push({id:nextConnectionId++,from:e,to:t,emoji:"ğŸ¤",color:"#4CAF50"}),document.getElementById("connectionModal").style.display="none",render(),saveState(),saveToLocalStorage(),showNotification("ğŸ”— Verbindung erstellt"))}function deleteConnection(e){confirm("Verbindung lÃ¶schen?")&&(connections=connections.filter((function(t){return t.id!==e.id})),render(),saveState(),saveToLocalStorage(),showNotification("ğŸ—‘ï¸ Verbindung gelÃ¶scht"))}function showReflexionModal(){const e=Object.keys(REFLEXIONS_SYSTEM);currentReflexionCategory=e[Math.floor(Math.random()*e.length)],currentReflexionIndex=0;const t=Math.random();currentQuestionType=t<.6?"text":t<.85?"scaling":"miracle",displayCurrentReflexion(),document.getElementById("reflexionModal").style.display="flex"}function displayCurrentReflexion(){const e=REFLEXIONS_SYSTEM[currentReflexionCategory];let t;if(document.getElementById("reflexionTitle").textContent="ğŸ’­ Systemische Reflexion",document.getElementById("reflexionCategory").textContent=e.name,document.getElementById("reflexionCategory").style.color=e.color,"text"===currentQuestionType)t=e.questions[currentReflexionIndex%e.questions.length],document.getElementById("reflexionQuestion").textContent=t,document.getElementById("reflexionInput").innerHTML='<textarea id="reflexionAnswer" rows="4" placeholder="Deine Gedanken und Erkenntnisse..."></textarea>';else if("scaling"===currentQuestionType){t=SCALING_QUESTIONS[Math.floor(Math.random()*SCALING_QUESTIONS.length)],document.getElementById("reflexionQuestion").textContent=t;let e='<div class="scaling-bar">';for(let t=1;t<=10;t++)e+='<button class="btn scaling-btn'+(t===currentScalingValue?" active":"")+'" onclick="selectScaling('+t+')">'+t+"</button>";e+="</div>",e+='<div class="scaling-labels"><span>niedrig</span><span>hoch</span></div>',document.getElementById("reflexionInput").innerHTML=e}else t=MIRACLE_QUESTIONS[Math.floor(Math.random()*MIRACLE_QUESTIONS.length)],document.getElementById("reflexionQuestion").textContent=t,document.getElementById("reflexionInput").innerHTML='<textarea id="reflexionAnswer" rows="4" placeholder="Was wÃ¼rde sich konkret Ã¤ndern?"></textarea>'}function selectScaling(e){currentScalingValue=e,document.querySelectorAll(".scaling-btn").forEach((function(t,n){n+1===e?t.classList.add("active"):t.classList.remove("active")}))}function saveReflexion(){let e;if("scaling"===currentQuestionType)e=currentScalingValue+"/10";else if(e=document.getElementById("reflexionAnswer").value,!e)return void showNotification("âš ï¸ Bitte Antwort eingeben");const t=REFLEXIONS_SYSTEM[currentReflexionCategory],n=document.getElementById("reflexionQuestion").textContent;reflexionAnswers.push({category:t.name,categoryColor:t.color,question:n,answer:e,type:currentQuestionType,timestamp:new Date().toLocaleString("de-DE")}),saveToLocalStorage(),updateReflexionsList(),updateStats(),showNotification("ğŸ’­ Reflexion gespeichert"),document.getElementById("reflexionModal").style.display="none"}function nextReflexion(){if(currentReflexionIndex++,currentReflexionIndex>=REFLEXIONS_SYSTEM[currentReflexionCategory].questions.length){const e=Object.keys(REFLEXIONS_SYSTEM),t=e.indexOf(currentReflexionCategory);currentReflexionCategory=e[(t+1)%e.length],currentReflexionIndex=0}const e=Math.random();currentQuestionType=e<.6?"text":e<.85?"scaling":"miracle",currentScalingValue=5,displayCurrentReflexion()}function toggleReflexionsPanel(){const e=document.getElementById("reflexionsPanel");"none"===e.style.display||!e.style.display?(e.style.display="block",updateReflexionsList()):e.style.display="none"}function updateReflexionsList(){const e=document.getElementById("reflexionsList");if(0===reflexionAnswers.length)return void(e.innerHTML='<p style="text-align: center; opacity: 0.7;">Noch keine Reflexionen</p>');let t="";reflexionAnswers.slice().reverse().forEach((function(e,n){const s=reflexionAnswers.length-1-n;t+='<div class="reflexion-item" style="border-left-color: '+e.categoryColor+';" oncontextmenu="showReflexionContextMenu(event, '+s+')"><div class="reflexion-category">'+e.category+'</div><div class="reflexion-question">'+e.question+'</div><div class="reflexion-answer">"'+e.answer+'"</div><div class="reflexion-timestamp">'+e.timestamp+"</div></div>"})),e.innerHTML=t}function showReflexionContextMenu(e,t){e.preventDefault(),e.stopPropagation(),selectedReflexionIndex=t,showContextMenu("reflexionContextMenu",e.clientX,e.clientY)}function editReflexion(e){const t=reflexionAnswers[e];showSimpleInput("Reflexion bearbeiten","Antwort:",!0,(function(e){e&&(t.answer=e,saveToLocalStorage(),updateReflexionsList(),showNotification("âœï¸ Reflexion aktualisiert"))})),document.getElementById("simpleTextareaField").value=t.answer}function deleteReflexion(e){confirm("Reflexion lÃ¶schen?")&&(reflexionAnswers.splice(e,1),saveToLocalStorage(),updateReflexionsList(),updateStats(),showNotification("ğŸ—‘ï¸ Reflexion gelÃ¶scht"))}function captureSnapshot(){showSimpleInput("Snapshot erstellen","Name:",!1,(function(e){e&&(snapshots.push({id:Date.now(),name:e,timestamp:new Date().toLocaleString("de-DE"),members:JSON.parse(JSON.stringify(members)),connections:JSON.parse(JSON.stringify(connections))}),currentSnapshotIndex=snapshots.length-1,saveToLocalStorage(),updateTimelineDisplay(),showNotification("ğŸ“· Snapshot erstellt: "+e))}))}function toggleTimeline(){const e=document.getElementById("timelinePanel");"none"===e.style.display||!e.style.display?(e.style.display="block",updateTimelineDisplay()):(e.style.display="none",isPlaying&&togglePlay())}function updateTimelineDisplay(){const e=document.getElementById("timelinePoints");e.innerHTML="",snapshots.forEach((function(t,n){const s=document.createElement("div");s.className="timeline-point",n===currentSnapshotIndex&&s.classList.add("active"),s.innerHTML='<div class="snapshot-name">'+t.name+'</div><div class="snapshot-time">'+t.timestamp.split(",")[1]+"</div>",s.onclick=function(e){e.target.closest(".timeline-point").classList.contains("dragging")||loadSnapshot(n)},s.oncontextmenu=function(e){e.preventDefault(),selectedSnapshotIndex=n;const t=s.getBoundingClientRect();showContextMenu("snapshotContextMenu",t.left,t.top-80)},s.draggable=!0,s.ondragstart=function(e){draggedSnapshot=t,draggedSnapshotIndex=n,s.classList.add("dragging")},s.ondragend=function(){s.classList.remove("dragging"),draggedSnapshot=null,draggedSnapshotIndex=-1},s.ondragover=function(e){e.preventDefault()},s.ondrop=function(e){if(e.preventDefault(),-1!==draggedSnapshotIndex&&draggedSnapshotIndex!==n){const e=snapshots[draggedSnapshotIndex];snapshots[draggedSnapshotIndex]=snapshots[n],snapshots[n]=e,currentSnapshotIndex===draggedSnapshotIndex?currentSnapshotIndex=n:currentSnapshotIndex===n&&(currentSnapshotIndex=draggedSnapshotIndex),updateTimelineDisplay(),saveToLocalStorage(),showNotification("â†”ï¸ Snapshot verschoben")}},e.appendChild(s)}))}function loadSnapshot(e){const t=snapshots[e];members=JSON.parse(JSON.stringify(t.members)),connections=JSON.parse(JSON.stringify(t.connections)),currentSnapshotIndex=e,members.length>0&&(nextId=Math.max.apply(Math,members.map((function(e){return e.id})))+1),connections.length>0&&(nextConnectionId=Math.max.apply(Math,connections.map((function(e){return e.id||0})))+1),render(),updateTimelineDisplay(),showNotification("ğŸ“Š Snapshot geladen: "+t.name)}function renameSnapshot(e){const t=snapshots[e];showSimpleInput("Snapshot umbenennen","Neuer Name:",!1,(function(e){e&&(t.name=e,updateTimelineDisplay(),saveToLocalStorage(),showNotification("âœï¸ Snapshot umbenannt"))}))}function deleteSnapshot(e){if(0===e)return void showNotification("âš ï¸ Erster Snapshot kann nicht gelÃ¶scht werden");const t=snapshots[e];confirm('Snapshot "'+t.name+'" lÃ¶schen?')&&(snapshots.splice(e,1),currentSnapshotIndex>=snapshots.length?currentSnapshotIndex=snapshots.length-1:currentSnapshotIndex>=e&&(currentSnapshotIndex=Math.max(0,currentSnapshotIndex-1)),updateTimelineDisplay(),saveToLocalStorage(),showNotification("ğŸ—‘ï¸ Snapshot gelÃ¶scht"))}function prevSnapshot(){currentSnapshotIndex>0&&loadSnapshot(currentSnapshotIndex-1)}function nextSnapshot(){currentSnapshotIndex<snapshots.length-1&&loadSnapshot(currentSnapshotIndex+1)}function togglePlay(){isPlaying=!isPlaying;const e=document.getElementById("btnPlayTimeline");isPlaying?(e.textContent="â¸ï¸",playInterval=setInterval((function(){currentSnapshotIndex<snapshots.length-1?loadSnapshot(currentSnapshotIndex+1):loadSnapshot(0)}),2e3)):(e.textContent="â–¶ï¸",clearInterval(playInterval))}async function captureCanvasScreenshot(){if(0===members.length){const e=document.getElementById("canvas");return await html2canvas(e,{backgroundColor:"#667eea",scale:2,logging:!1})}let e=1/0,t=-1/0,n=1/0,s=-1/0;members.forEach((function(o){e=Math.min(e,o.x),t=Math.max(t,o.x+100),n=Math.min(n,o.y),s=Math.max(s,o.y+100)}));const o=80,i=Math.max(0,e-o),c=Math.max(0,n-o),r=t-e+2*o,a=s-n+2*o,l=document.getElementById("canvas");return await html2canvas(l,{backgroundColor:"#667eea",scale:2,logging:!1,x:i,y:c,width:r,height:a,windowWidth:l.scrollWidth,windowHeight:l.scrollHeight})}async function exportWorksheet(){showNotification("ğŸ“¸ Erstelle Screenshot...");const e=await captureCanvasScreenshot(),t=e.toDataURL("image/png"),n=members.find((function(e){return e.isSelf})),s=new Date().toLocaleDateString("de-DE"),o=new Date().toLocaleTimeString("de-DE");let i='<!DOCTYPE html>\n<html lang="de">\n<head>\n<meta charset="UTF-8">\n<title>Systemisches Arbeitsblatt - '+s+'</title>\n<style>* { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: "Segoe UI", Arial, sans-serif; padding: 40px; max-width: 1200px; margin: 0 auto; background: #f5f5f5; } .header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); } h1 { font-size: 2.5rem; margin-bottom: 10px; } .section { background: white; padding: 30px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); } h2 { color: #667eea; margin-bottom: 20px; font-size: 1.8rem; border-bottom: 3px solid #667eea; padding-bottom: 10px; } .screenshot-box { text-align: center; margin: 20px 0; padding: 20px; background: #f9f9f9; border-radius: 10px; border: 2px solid #667eea; } .screenshot-box img { max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); } .screenshot-caption { margin-top: 10px; font-size: 0.9rem; color: #666; font-style: italic; } .member-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; } .member-card { background: linear-gradient(135deg, #f5f7fa, #c3cfe2); padding: 20px; border-radius: 10px; border-left: 5px solid #667eea; } .member-name { font-size: 1.2rem; font-weight: 700; margin-bottom: 10px; } .connections-list { display: flex; flex-wrap: wrap; gap: 15px; } .connection-badge { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 12px 20px; border-radius: 20px; font-size: 1rem; font-weight: 600; } .reflexion-card { background: #f9f9f9; padding: 20px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #4CAF50; } .assignment-box { background: rgba(33,150,243,0.1); border-left: 4px solid #2196F3; padding: 20px; border-radius: 8px; margin-top: 20px; } .assignment-item { margin-bottom: 15px; } .assignment-text { font-weight: 600; margin-bottom: 8px; color: #333; line-height: 1.5; } .note-lines { margin-top: 8px; } .note-line { height: 30px; border-bottom: 1px solid #ccc; margin: 5px 0; } .empty-state { text-align: center; color: #999; padding: 40px; } @media print { body { background: white; } .section { page-break-inside: avoid; } }</style>\n</head>\n<body>\n';if(i+='<div class="header"><h1>ğŸ¯ Reflexions-Radar</h1><div>Systemisches Arbeitsblatt vom '+s+", "+o+"</div>",n&&(i+="<div style=\"margin-top:10px\">FÃ¼r: "+n.name+" | Stress: "+n.stress+"/5</div>"),i+="</div>\n",i+='<div class="section"><h2>ğŸ“¸ Team-Skulptur Ãœbersicht</h2><div class="screenshot-box"><img src="'+t+'" alt="Team Skulptur Screenshot"><div class="screenshot-caption">Aktuelle Team-Konstellation vom '+s+" um "+o+"</div></div></div>\n",i+='<div class="section"><h2>ğŸ‘¥ Team-Konstellation</h2>',0===members.length)i+='<div class="empty-state">Noch keine Personen</div>';else{i+='<div class="member-grid">',members.forEach((function(e){i+='<div class="member-card"><div class="member-name">'+e.name+(e.isSelf?" â­":"")+"</div><div>Stress: "+e.stress+"/5</div>",e.notes&&(i+='<div style="margin-top:10px;font-style:italic">ğŸ“ '+e.notes+"</div>"),i+="</div>"})),i+="</div>"}if(i+="</div>\n",i+='<div class="section"><h2>ğŸ”— Verbindungen</h2>',0===connections.length)i+='<div class="empty-state">Keine Verbindungen</div>';else{i+='<div class="connections-list">',connections.forEach((function(e){const t=members.find((function(t){return t.id===e.from})),n=members.find((function(t){return t.id===e.to}));t&&n&&(i+='<div class="connection-badge">'+t.name+" "+e.emoji+" "+n.name+"</div>")})),i+="</div>"}if(i+="</div>\n",i+='<div class="section"><h2>ğŸ’­ Reflexionen</h2>',0===reflexionAnswers.length)i+='<div class="empty-state">Keine Reflexionen</div>';else{reflexionAnswers.forEach((function(e){i+='<div class="reflexion-card"><div style="font-weight:600;margin-bottom:10px">'+e.question+'</div><div style="font-style:italic">"'+e.answer+'"</div><div style="font-size:0.85rem;color:#999;margin-top:5px">'+e.timestamp+"</div></div>"}))}i+="</div>\n",i+='<div class="section"><h2>ğŸ¯ BeobachtungsauftrÃ¤ge</h2><div class="assignment-box">';const c=[];Object.keys(REFLEXIONS_SYSTEM).forEach((function(e){c.length<3&&c.push(REFLEXIONS_SYSTEM[e].assignments[Math.floor(Math.random()*REFLEXIONS_SYSTEM[e].assignments.length)])})),c.forEach((function(e){i+='<div class="assignment-item"><div class="assignment-text">â€¢ '+e+'</div><div class="note-lines">',i+='<div class="note-line"></div>',i+='<div class="note-line"></div>',i+='<div class="note-line"></div>',i+='<div class="note-line"></div>',i+="</div></div>"})),i+="</div></div>\n",i+="</body></html>";const r=new Blob([i],{type:"text/html"}),a=URL.createObjectURL(r),l=document.createElement("a");l.href=a,l.download="Arbeitsblatt-"+s.replace(/\./g,"-")+".html",l.click(),showNotification("ğŸ“„ Arbeitsblatt exportiert")}function exportJSON(){const e={version:APP_VERSION,timestamp:(new Date).toISOString(),members:members,connections:connections,snapshots:snapshots,reflexions:reflexionAnswers},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download="reflexions-radar-"+Date.now()+".json",s.click(),showNotification("ğŸ’¾ JSON exportiert")}function showSessionModal(){document.getElementById("sessionModal").style.display="flex",updateSessionsList()}function saveSession(){const e=document.getElementById("sessionName").value;if(!e)return void showNotification("âš ï¸ Bitte Namen eingeben");sessions.push({id:Date.now(),name:e,timestamp:new Date().toLocaleString("de-DE"),data:{members:members,connections:connections,snapshots:snapshots,reflexions:reflexionAnswers}}),saveToLocalStorage(),updateSessionsList(),document.getElementById("sessionName").value="",showNotification("ğŸ’¾ Session gespeichert: "+e)}function updateSessionsList(){const e=document.getElementById("sessionsList");if(0===sessions.length)return void(e.innerHTML='<p style="text-align: center; color: #999; padding: 20px;">Keine Sessions</p>');let t="";sessions.slice().reverse().forEach((function(e,n){const s=sessions.length-1-n;t+='<div class="session-item"><div class="session-info"><div class="session-name">'+e.name+'</div><div class="session-timestamp">'+e.timestamp+'</div></div><button class="btn" onclick="loadSession('+s+')" style="padding: 6px 12px; font-size: 12px;">ğŸ“‚ Laden</button></div>'})),e.innerHTML=t}function loadSession(e){const t=sessions[e];members=JSON.parse(JSON.stringify(t.data.members)),connections=JSON.parse(JSON.stringify(t.data.connections)),snapshots=JSON.parse(JSON.stringify(t.data.snapshots)),reflexionAnswers=JSON.parse(JSON.stringify(t.data.reflexions)),currentSnapshotIndex=0,members.length>0&&(nextId=Math.max.apply(Math,members.map((function(e){return e.id})))+1),connections.length>0&&(nextConnectionId=Math.max.apply(Math,connections.map((function(e){return e.id||0})))+1),render(),saveToLocalStorage(),document.getElementById("sessionModal").style.display="none",showNotification("ğŸ“‚ Session geladen: "+t.name)}function importSession(){const e=document.getElementById("sessionFile"),t=e.files[0];if(!t)return void showNotification("âš ï¸ Keine Datei");const n=new FileReader;n.onload=function(e){try{const t=JSON.parse(e.target.result);members=t.members||[],connections=t.connections||[],snapshots=t.snapshots||[],reflexionAnswers=t.reflexions||[],members.length>0&&(nextId=Math.max.apply(Math,members.map((function(e){return e.id})))+1),connections.length>0&&(nextConnectionId=Math.max.apply(Math,connections.map((function(e){return e.id||0})))+1),render(),saveToLocalStorage(),document.getElementById("sessionModal").style.display="none",showNotification("âœ… Importiert")}catch(e){showNotification("âŒ Fehler")}},n.readAsText(t)}function clearSessions(){confirm("Alle Sessions lÃ¶schen?")&&(sessions=[],saveToLocalStorage(),updateSessionsList(),showNotification("ğŸ—‘ï¸ Sessions gelÃ¶scht"))}function toggleThermometer(){const e=document.getElementById("stressThermometer"),t=document.getElementById("thermometerToggle");e.classList.contains("collapsed")?(e.classList.remove("collapsed"),t.textContent="â—€"):(e.classList.add("collapsed"),t.textContent="â–¶")}function showSimpleInput(e,t,n,s){window.simpleInputCallback=s,document.getElementById("simpleInputTitle").textContent=e,n?(document.getElementById("simpleInputField").style.display="none",document.getElementById("simpleTextareaField").style.display="block",document.getElementById("simpleTextareaField").placeholder=t):(document.getElementById("simpleInputField").style.display="block",document.getElementById("simpleTextareaField").style.display="none",document.getElementById("simpleInputField").placeholder=t,document.getElementById("simpleInputField").value=""),document.getElementById("simpleInputModal").style.display="flex"}function showContextMenu(e,t,n){hideAllContextMenus();const s=document.getElementById(e);s.style.left=t+"px",s.style.top=n+"px",s.style.display="block"}function hideAllContextMenus(){document.querySelectorAll(".context-menu").forEach((function(e){e.style.display="none"}))}function showEmojiSelector(e){selectedConnection=e;const t=document.getElementById("emojiSelector");t.style.display="block",t.style.left="50%",t.style.top="50%",t.style.transform="translate(-50%, -50%)"}function hideEmojiSelector(){document.getElementById("emojiSelector").style.display="none"}function showColorSelector(e){selectedConnection=e;const t=document.getElementById("colorSelector");t.style.display="block",t.style.left="50%",t.style.top="50%",t.style.transform="translate(-50%, -50%)"}function hideColorSelector(){document.getElementById("colorSelector").style.display="none"}function showNotification(e){const t=document.createElement("div");t.className="notification",t.textContent=e,document.body.appendChild(t),setTimeout((function(){t.remove()}),3e3)}function resetApp(){confirm("Alles zurÃ¼cksetzen?")&&(members=[],connections=[],snapshots=[{id:Date.now(),name:"Ausgangssituation",timestamp:new Date().toLocaleString("de-DE"),members:[],connections:[]}],reflexionAnswers=[],nextId=1,nextConnectionId=1,personCounter=1,currentSnapshotIndex=0,history=[],historyIndex=-1,render(),saveToLocalStorage(),showNotification("ğŸ”„ Reset!"))}function saveToLocalStorage(){const e={members:members,connections:connections,snapshots:snapshots,reflexions:reflexionAnswers,sessions:sessions,nextId:nextId,nextConnectionId:nextConnectionId,personCounter:personCounter,thermometerPos:thermometerPos};localStorage.setItem("reflexionsRadar",JSON.stringify(e))}function loadFromLocalStorage(){const e=localStorage.getItem("reflexionsRadar");if(e)try{const t=JSON.parse(e);if(members=t.members||[],connections=t.connections||[],snapshots=t.snapshots||[],reflexionAnswers=t.reflexions||[],sessions=t.sessions||[],nextId=t.nextId||1,nextConnectionId=t.nextConnectionId||1,personCounter=t.personCounter||1,thermometerPos=t.thermometerPos||{top:90,right:20},(members.length>0||connections.length>0)&&(history=[{members:JSON.parse(JSON.stringify(members)),connections:JSON.parse(JSON.stringify(connections))}],historyIndex=0),thermometerPos.left!==undefined){const e=document.getElementById("stressThermometer");e&&(e.style.left=thermometerPos.left+"px",e.style.top=thermometerPos.top+"px",e.style.right="auto")}}catch(e){console.error("Error loading data:",e)}}window.selectScaling=selectScaling,window.showReflexionContextMenu=showReflexionContextMenu,window.loadSession=loadSession,init();
    </script>
</body>
</html>
